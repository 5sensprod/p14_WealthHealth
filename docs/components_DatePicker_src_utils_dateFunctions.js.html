<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/DatePicker/src/utils/dateFunctions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/DatePicker/src/utils/dateFunctions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { DEFAULT_CONFIG } from '../config/defaultConfig'
// ========== DATE UTILITIES ==========

const DAYS_IN_A_WEEK = 7

/**
 * Ajuste l'index du jour de départ en fonction de la configuration du jour de début de semaine.
 *
 * @function
 * @param {number} dayIndex - Index du jour de la semaine (0 pour Dimanche, 1 pour Lundi, etc.).
 * @param {number} startOfWeek - Index du premier jour de la semaine selon la configuration.
 * @returns {number} - Index ajusté du jour.
 */
const adjustStartOfWeek = (dayIndex, startOfWeek) => {
  const adjustedIndex = dayIndex - startOfWeek
  return adjustedIndex &lt; 0 ? adjustedIndex + DAYS_IN_A_WEEK : adjustedIndex
}

/**
 * Génère une liste de jours.
 *
 * @function
 * @param {number} start - Jour de début.
 * @param {number} end - Jour de fin.
 * @param {boolean} isGrayed - Indique si les jours doivent être grisés.
 * @returns {Array} - Liste des jours.
 */
const generateDays = (start, end, isGrayed = false) =>
  new Array(end - start + 1).fill(null).map((_, index) => ({
    number: start + index,
    isGrayed,
  }))

/**
 * Génère la liste complète des emplacements de jour pour un mois donné.
 *
 * @function
 * @param {Date} currentMonth - Date représentant le mois actuel.
 * @param {number} startOfWeek - Index du premier jour de la semaine.
 * @returns {Array} - Liste des emplacements de jour.
 */
export function generateTotalSlots(currentMonth, startOfWeek = 0) {
  const currentYear = currentMonth.getFullYear()
  const currentMonthIndex = currentMonth.getMonth()

  const daysInCurrentMonth = getDaysInMonth(currentYear, currentMonthIndex)
  const daysInPreviousMonth = getDaysInMonth(currentYear, currentMonthIndex - 1)

  const firstDayOfCurrentMonth = adjustStartOfWeek(
    new Date(currentYear, currentMonthIndex, 1).getDay(),
    startOfWeek,
  )

  const leadingDaysCount = firstDayOfCurrentMonth
  const trailingDaysCount =
    (DAYS_IN_A_WEEK -
      ((leadingDaysCount + daysInCurrentMonth) % DAYS_IN_A_WEEK)) %
    DAYS_IN_A_WEEK

  const leadingDaysFromPreviousMonth = generateDays(
    daysInPreviousMonth - leadingDaysCount + 1,
    daysInPreviousMonth,
    true,
  )
  const daysOfCurrentMonth = generateDays(1, daysInCurrentMonth)
  const trailingDaysForNextMonth = generateDays(1, trailingDaysCount, true)

  return [
    ...leadingDaysFromPreviousMonth,
    ...daysOfCurrentMonth,
    ...trailingDaysForNextMonth,
  ]
}

/**
 * Abbrège le nom du mois si sa longueur dépasse 5 caractères.
 *
 * @function
 * @param {string} month - Nom complet du mois.
 * @returns {string} - Nom du mois abrégé.
 */
export function abbreviateMonth(month) {
  return month.length > 5 ? month.substring(0, 4) + '.' : month
}

/**
 * Obtient le nombre de jours dans un mois donné.
 *
 * @function
 * @param {number} year - L'année.
 * @param {number} month - Le mois (0 pour Janvier, 1 pour Février, etc.).
 * @returns {number} - Nombre de jours dans le mois.
 */
export function getDaysInMonth(year, month) {
  return new Date(year, month + 1, 0).getDate()
}

/**
 * Formate une date en fonction du format souhaité.
 *
 * @function
 * @param {Date|string} value - Date à formater.
 * @param {string} dateFormat - Format de date souhaité.
 * @returns {string} - Date formatée.
 */
export function formatDatePickerDate(
  value,
  dateFormat = DEFAULT_CONFIG.DATE_FORMATS.DEFAULT,
) {
  if (!(value instanceof Date)) {
    return value
  }

  const day = value.getDate()
  const month = value.getMonth() + 1
  const year = value.getFullYear()

  switch (dateFormat) {
    case 'YYYY-MM-DD':
      return `${year}/${month.toString().padStart(2, '0')}/${day
        .toString()
        .padStart(2, '0')}`
    case 'MM-DD-YYYY':
      return `${month.toString().padStart(2, '0')}/${day
        .toString()
        .padStart(2, '0')}/${year}`
    case 'DD-MM-YYYY':
      return `${day.toString().padStart(2, '0')}/${month
        .toString()
        .padStart(2, '0')}/${year}`
    default:
      return value
  }
}

/**
 * Convertit une date formatée en chaîne de caractères en un objet Date.
 *
 * @function
 * @param {string} dateString - Date sous forme de chaîne de caractères.
 * @param {string} format - Format de date utilisé.
 * @returns {Date} - Objet Date correspondant.
 */
export function convertFormattedStringToDate(
  dateString,
  format = DEFAULT_CONFIG.DATE_FORMATS.DEFAULT,
) {
  const parts = dateString.split('/')

  switch (format) {
    case 'DD-MM-YYYY':
      return new Date(
        Date.UTC(
          parseInt(parts[2]),
          parseInt(parts[1]) - 1,
          parseInt(parts[0]),
        ),
      )
    case 'MM-DD-YYYY':
      return new Date(
        Date.UTC(
          parseInt(parts[2]),
          parseInt(parts[0]) - 1,
          parseInt(parts[1]),
        ),
      )
    case 'YYYY-MM-DD':
      return new Date(
        Date.UTC(
          parseInt(parts[0]),
          parseInt(parts[1]) - 1,
          parseInt(parts[2]),
        ),
      )
    default:
      throw new Error(`Invalid date format: ${format}`)
  }
}

/**
 * Détermine si une année donnée est une année bissextile ou non.
 *
 * @function
 * @param {number} year - L'année à vérifier.
 * @returns {boolean} - Retourne `true` si l'année est bissextile, sinon `false`.
 */
function isLeapYear(year) {
  return (year % 4 === 0 &amp;&amp; year % 100 !== 0) || year % 400 === 0
}

function generateRegex(formatKey, separator) {
  const formatMapping = {
    DEFAULT: `^(\\d{2})${separator}(\\d{2})${separator}(\\d{4})$`,
    US: `^(\\d{2})${separator}(\\d{2})${separator}(\\d{4})$`,
    ISO: `^(\\d{4})${separator}(\\d{2})${separator}(\\d{2})$`,
  }
  return formatMapping[formatKey]
}

/**
 * Vérifie si une date est valide.
 *
 * @function
 * @param {string} dateString - Date sous forme de chaîne de caractères.
 * @param {string} formatKey - Clé de format de date à utiliser.
 * @param {number} minYear - Année minimale autorisée.
 * @param {number} maxYear - Année maximale autorisée.
 * @returns {object} - Un objet avec `isValid` indiquant si la date est valide et `errorType` indiquant le type d'erreur.
 */
export function isValidDate(
  dateString,
  formatKey = DEFAULT_CONFIG.DATE_FORMAT,
  minYear = DEFAULT_CONFIG.MIN_YEAR,
  maxYear = DEFAULT_CONFIG.MAX_YEAR,
) {
  let day, month, year
  const separator = dateString.includes('/') ? '/' : '-'
  const format = DEFAULT_CONFIG.DATE_FORMATS[formatKey]

  const regex = generateRegex(formatKey, separator)
  if (!new RegExp(regex).test(dateString))
    return { isValid: false, errorType: 'invalidDate' }

  switch (format) {
    case DEFAULT_CONFIG.DATE_FORMATS.DEFAULT:
      ;[day, month, year] = dateString.split(separator).map(Number)
      break
    case DEFAULT_CONFIG.DATE_FORMATS.US:
      ;[month, day, year] = dateString.split(separator).map(Number)
      break
    case DEFAULT_CONFIG.DATE_FORMATS.ISO:
      ;[year, month, day] = dateString.split(separator).map(Number)
      break
    default:
      return { isValid: false, errorType: 'unsupportedFormat' }
  }

  if (isNaN(day) || isNaN(month) || isNaN(year))
    return { isValid: false, errorType: 'invalidDate' }
  if (day &lt; 1 || day > 31 || month &lt; 1 || month > 12)
    return { isValid: false, errorType: 'invalidDate' }
  if (year &lt; minYear || year > maxYear)
    return { isValid: false, errorType: 'outOfRange' }

  if (month === 2) {
    if (isLeapYear(year) &amp;&amp; day > 29)
      return { isValid: false, errorType: 'invalidDate' }
    if (!isLeapYear(year) &amp;&amp; day > 28)
      return { isValid: false, errorType: 'invalidDate' }
  } else {
    const daysInMonth = new Date(year, month, 0).getDate()
    if (day > daysInMonth) return { isValid: false, errorType: 'invalidDate' }
  }

  return { isValid: true, errorType: null }
}

const MASK_FORMATS = {
  [DEFAULT_CONFIG.DATE_FORMATS.DEFAULT]: [2, 5],
  [DEFAULT_CONFIG.DATE_FORMATS.US]: [2, 5],
  [DEFAULT_CONFIG.DATE_FORMATS.ISO]: [4, 7],
}

/**
 * Formate une date pour correspondre à un masque donné.
 *
 * @function
 * @param {string} value - Date sous forme de chaîne de caractères.
 * @param {string} format - Format souhaité pour le masque.
 * @param {string} separator - Séparateur à utiliser dans la date (par défaut '/').
 * @returns {string} - Date formatée selon le masque.
 */
export function formatToMask(
  value,
  format = DEFAULT_CONFIG.DATE_FORMATS.DEFAULT,
  separator = '/',
) {
  if (value.match(/^\d{4}-\d{2}-\d{2}$/)) {
    const [year, month, day] = value.split('-')
    switch (format) {
      case DEFAULT_CONFIG.DATE_FORMATS.US:
        value = `${month}${day}${year}`
        break
      case DEFAULT_CONFIG.DATE_FORMATS.DEFAULT:
        value = `${day}${month}${year}`
        break
      case DEFAULT_CONFIG.DATE_FORMATS.ISO:
        // Do nothing as the format is already correct.
        break
      default:
        throw new Error(`Invalid format: ${format}`)
    }
  }

  const positions = MASK_FORMATS[format] || []
  if (!positions.length) {
    throw new Error(`Invalid format: ${format}`)
  }

  let maskedValue = value.replace(/\D/g, '')

  positions.forEach((position) => {
    if (maskedValue.length > position) {
      maskedValue = `${maskedValue.substring(
        0,
        position,
      )}${separator}${maskedValue.substring(position)}`
    }
  })

  return maskedValue
}

/**
 * Sélectionne une date.
 *
 * Cette fonction met à jour la date sélectionnée et ferme le calendrier.
 *
 * @function
 * @param {function} selectDate - Fonction pour sélectionner une date.
 * @param {function} closeCalendar - Fonction pour fermer le calendrier.
 * @param {Date} currentMonth - Mois actuellement affiché.
 * @param {object} day - Jour sélectionné.
 */
export function chooseDate(selectDate, closeCalendar, currentMonth, day) {
  selectDate(
    `${currentMonth.getFullYear()}-${String(
      currentMonth.getMonth() + 1,
    ).padStart(2, '0')}-${String(day).padStart(2, '0')}`,
  )
  closeCalendar()
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html"></a></li><li><a href="global.html#AddEmployee">AddEmployee</a></li><li><a href="global.html#AddressFields">AddressFields</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#Button">Button</a></li><li><a href="global.html#CONFIG_VALIDATION_RULES">CONFIG_VALIDATION_RULES</a></li><li><a href="global.html#Calendar">Calendar</a></li><li><a href="global.html#CalendarButton">CalendarButton</a></li><li><a href="global.html#CalendarIcon">CalendarIcon</a></li><li><a href="global.html#ChevronButton">ChevronButton</a></li><li><a href="global.html#ChevronButtons">ChevronButtons</a></li><li><a href="global.html#ChevronIcon">ChevronIcon</a></li><li><a href="global.html#DAYS">DAYS</a></li><li><a href="global.html#DEFAULT_CONFIG">DEFAULT_CONFIG</a></li><li><a href="global.html#DateGrid">DateGrid</a></li><li><a href="global.html#DateInputField">DateInputField</a></li><li><a href="global.html#DatePicker">DatePicker</a></li><li><a href="global.html#DaysView">DaysView</a></li><li><a href="global.html#EmployeeForm">EmployeeForm</a></li><li><a href="global.html#EmployeeTable">EmployeeTable</a></li><li><a href="global.html#Employees">Employees</a></li><li><a href="global.html#FORWARD">FORWARD</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#HomeButton">HomeButton</a></li><li><a href="global.html#HomeIcon">HomeIcon</a></li><li><a href="global.html#InputField">InputField</a></li><li><a href="global.html#Layout">Layout</a></li><li><a href="global.html#Logo">Logo</a></li><li><a href="global.html#MaskedInput">MaskedInput</a></li><li><a href="global.html#MonthSelector">MonthSelector</a></li><li><a href="global.html#MonthsView">MonthsView</a></li><li><a href="global.html#Navigation">Navigation</a></li><li><a href="global.html#NotFound">NotFound</a></li><li><a href="global.html#ReactPropTypesSecret_1">ReactPropTypesSecret_1</a></li><li><a href="global.html#YearSelector">YearSelector</a></li><li><a href="global.html#YearsView">YearsView</a></li><li><a href="global.html#abbreviateMonth">abbreviateMonth</a></li><li><a href="global.html#adjustStartOfWeek">adjustStartOfWeek</a></li><li><a href="global.html#applyYearConfig">applyYearConfig</a></li><li><a href="global.html#calculateNewDate">calculateNewDate</a></li><li><a href="global.html#chooseDate">chooseDate</a></li><li><a href="global.html#convertFormattedStringToDate">convertFormattedStringToDate</a></li><li><a href="global.html#createEscapeHandler">createEscapeHandler</a></li><li><a href="global.html#employeeSlice">employeeSlice</a></li><li><a href="global.html#factoryWithThrowingShims">factoryWithThrowingShims</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatDatePickerDate">formatDatePickerDate</a></li><li><a href="global.html#formatDateWithSlashes">formatDateWithSlashes</a></li><li><a href="global.html#formatToMask">formatToMask</a></li><li><a href="global.html#generateDays">generateDays</a></li><li><a href="global.html#generateTotalSlots">generateTotalSlots</a></li><li><a href="global.html#getDaysInMonth">getDaysInMonth</a></li><li><a href="global.html#getTranslations">getTranslations</a></li><li><a href="global.html#goToNextMonth">goToNextMonth</a></li><li><a href="global.html#handleDateSelect">handleDateSelect</a></li><li><a href="global.html#handleEmptyInput">handleEmptyInput</a></li><li><a href="global.html#handleIncompleteInput">handleIncompleteInput</a></li><li><a href="global.html#handleInvalidDate">handleInvalidDate</a></li><li><a href="global.html#handleNavigationKeys">handleNavigationKeys</a></li><li><a href="global.html#handlePropsAndConfig">handlePropsAndConfig</a></li><li><a href="global.html#handleTabKey">handleTabKey</a></li><li><a href="global.html#handleValidDate">handleValidDate</a></li><li><a href="global.html#initialEmployees">initialEmployees</a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#isLeapYear">isLeapYear</a></li><li><a href="global.html#isValidDate">isValidDate</a></li><li><a href="global.html#preloadedState">preloadedState</a></li><li><a href="global.html#processYearConfig">processYearConfig</a></li><li><a href="global.html#reorderDays">reorderDays</a></li><li><a href="global.html#resetToCurrentDate">resetToCurrentDate</a></li><li><a href="global.html#savedEmployees">savedEmployees</a></li><li><a href="global.html#store">store</a></li><li><a href="global.html#switchToMonthView">switchToMonthView</a></li><li><a href="global.html#toggleCalendarVisibility">toggleCalendarVisibility</a></li><li><a href="global.html#toggleYearView">toggleYearView</a></li><li><a href="global.html#updateInput">updateInput</a></li><li><a href="global.html#updateMonth">updateMonth</a></li><li><a href="global.html#useCalendarLogic">useCalendarLogic</a></li><li><a href="global.html#useDatePickerState">useDatePickerState</a></li><li><a href="global.html#useDateValidation">useDateValidation</a></li><li><a href="global.html#useDesignStyles">useDesignStyles</a></li><li><a href="global.html#useEscapeKey">useEscapeKey</a></li><li><a href="global.html#useFormData">useFormData</a></li><li><a href="global.html#useFormErrors">useFormErrors</a></li><li><a href="global.html#useKeyboardAccessibility">useKeyboardAccessibility</a></li><li><a href="global.html#useOutsideInteractions">useOutsideInteractions</a></li><li><a href="global.html#useYearLogic">useYearLogic</a></li><li><a href="global.html#validateDateFormat">validateDateFormat</a></li><li><a href="global.html#validateEmployeeForm">validateEmployeeForm</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Sep 11 2023 20:45:57 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
